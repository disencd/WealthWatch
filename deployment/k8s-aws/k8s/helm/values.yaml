# Default values for wealthwatch Helm chart
# This is a YAML-formatted file.

# Global settings
global:
  imageRegistry: ""
  imagePullSecrets: []
  storageClass: "gp3"

# Application image settings
image:
  registry: YOUR_ECR_REPO
  repository: wealthwatch
  tag: "latest"
  pullPolicy: Always
  pullSecrets: []

# Replica count
replicaCount: 3

# Resource limits and requests
resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 250m
    memory: 256Mi

# Autoscaling settings
autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 20
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80
  # Custom metrics (if Prometheus is installed)
  customMetrics: []

# Service configuration
service:
  type: ClusterIP
  port: 80
  targetPort: 8080
  annotations: {}

# Ingress configuration
ingress:
  enabled: true
  className: "alb"
  annotations:
    kubernetes.io/ingress.class: "alb"
    alb.ingress.kubernetes.io/scheme: internet-facing
    alb.ingress.kubernetes.io/target-type: ip
    alb.ingress.kubernetes.io/healthcheck-path: /health
    alb.ingress.kubernetes.io/ssl-policy: ELBSecurityPolicy-TLS-1-2-2017-01
    alb.ingress.kubernetes.io/redirect-http-to-https: "true"
  hosts:
    - host: wealthwatch.yourdomain.com
      paths:
        - path: /
          pathType: Prefix
  tls:
    - secretName: wealthwatch-tls
      hosts:
        - wealthwatch.yourdomain.com

# Environment variables
env:
  # Server configuration
  GIN_MODE: "release"
  PORT: "8080"
  LOG_LEVEL: "info"
  
  # Database configuration
  DB_PORT: "5432"
  DB_NAME: "wealthwatch_prod"
  DB_USER: "wealthwatch"
  DB_SSLMODE: "require"
  
  # Redis configuration
  REDIS_PORT: "6379"
  
  # JWT configuration
  JWT_EXPIRES_IN: "24h"
  
  # CORS configuration
  CORS_ALLOWED_ORIGINS: "https://wealthwatch.yourdomain.com"
  
  # Rate limiting
  RATE_LIMIT_REQUESTS_PER_MINUTE: "100"
  
  # File upload
  MAX_FILE_SIZE: "10MB"
  UPLOAD_PATH: "/app/uploads"
  
  # Monitoring
  ENABLE_METRICS: "true"
  METRICS_PORT: "9090"

# Secret environment variables (base64 encoded)
secrets:
  DB_HOST: ""
  DB_PASSWORD: ""
  JWT_SECRET: ""
  REDIS_HOST: ""
  REDIS_AUTH_TOKEN: ""
  SMTP_HOST: ""
  SMTP_EMAIL: ""
  SMTP_PASSWORD: ""
  STRIPE_API_KEY: ""
  SENTRY_DSN: ""
  AWS_ACCESS_KEY_ID: ""
  AWS_SECRET_ACCESS_KEY: ""
  AWS_S3_BUCKET: ""
  AWS_REGION: ""

# Persistence
persistence:
  enabled: true
  storageClass: "gp3"
  size: 10Gi
  accessMode: ReadWriteOnce
  annotations: {}

# Security context
securityContext:
  runAsNonRoot: true
  runAsUser: 1000
  runAsGroup: 2000
  fsGroup: 2000
  capabilities:
    drop:
    - ALL

# Pod security context
podSecurityContext:
  seccompProfile:
    type: RuntimeDefault

# Service account
serviceAccount:
  create: true
  annotations: {}
    # eks.amazonaws.com/role-arn: arn:aws:iam::ACCOUNT:role/wealthwatch-eks-role
  name: "wealthwatch-sa"

# RBAC
rbac:
  create: true

# Network policies
networkPolicy:
  enabled: true
  ingress:
    - from:
        - namespaceSelector:
            matchLabels:
              name: ingress-nginx
        - namespaceSelector:
            matchLabels:
              name: kube-system
      ports:
        - protocol: TCP
          port: 8080
  egress:
    - to: []
      ports:
        - protocol: TCP
          port: 53
        - protocol: UDP
          port: 53
        - protocol: TCP
          port: 80
        - protocol: TCP
          port: 443
        - protocol: TCP
          port: 5432
        - protocol: TCP
          port: 6379

# Probes
livenessProbe:
  httpGet:
    path: /health
    port: http
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

readinessProbe:
  httpGet:
    path: /health
    port: http
  initialDelaySeconds: 5
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 3

startupProbe:
  httpGet:
    path: /health
    port: http
  initialDelaySeconds: 10
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 30

# Node selector
nodeSelector: {}
  # kubernetes.io/arch: amd64

# Tolerations
tolerations: []
  # - key: "workload"
  #   operator: "Equal"
  #   value: "app"
  #   effect: "NoSchedule"

# Affinity
affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
              - key: app
                operator: In
                values:
                  - wealthwatch
          topologyKey: kubernetes.io/hostname

# Pod annotations
podAnnotations: {}
  # prometheus.io/scrape: "true"
  # prometheus.io/port: "9090"
  # prometheus.io/path: "/metrics"

# Pod labels
podLabels: {}

# Init containers
initContainers: []

# Sidecars
sidecars: []

# Extra volumes
extraVolumes: []

# Extra volume mounts
extraVolumeMounts: []

# Priority class
priorityClassName: ""

# Pod disruption budget
podDisruptionBudget:
  enabled: true
  minAvailable: 1
  # maxUnavailable: 1

# Vertical Pod Autoscaler
vpa:
  enabled: false
  updateMode: "Auto"
  resourcePolicy:
    containerPolicies:
      - containerName: wealthwatch
        maxAllowed:
          cpu: 2
          memory: 2Gi
        minAllowed:
          cpu: 100m
          memory: 128Mi

# Monitoring
monitoring:
  enabled: false
  serviceMonitor:
    enabled: false
    namespace: monitoring
    labels: {}
    annotations: {}
    interval: 30s
    scrapeTimeout: 10s

# Pod security policies (for Kubernetes < 1.25)
podSecurityPolicy:
  enabled: false

# Custom init scripts
initScripts: []

# Environment-specific values
production:
  replicaCount: 5
  resources:
    limits:
      cpu: 1000m
      memory: 1Gi
    requests:
      cpu: 500m
      memory: 512Mi
  autoscaling:
    minReplicas: 3
    maxReplicas: 50

staging:
  replicaCount: 2
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 250m
      memory: 256Mi
  autoscaling:
    minReplicas: 1
    maxReplicas: 5

development:
  replicaCount: 1
  resources:
    limits:
      cpu: 250m
      memory: 256Mi
    requests:
      cpu: 100m
      memory: 128Mi
  autoscaling:
    enabled: false
